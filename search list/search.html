<!DOCTYPE html>
<html lang="en">
<head>
    <!-- meta정보 -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- 구글 폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=BhuTuka+Expanded+One&family=Comfortaa:wght@600&family=Do+Hyeon&family=Gowun+Dodum&family=Hi+Melody&family=Nanum+Pen+Script&family=Noto+Sans+SC:wght@100;400&family=Oswald:wght@300&family=Permanent+Marker&family=Quintessential&family=Rowdies:wght@300;400&family=Sedgwick+Ave&family=Shadows+Into+Light&family=Source+Code+Pro:wght@200&family=Staatliches&family=Stylish&family=Sunflower:wght@300&family=ZCOOL+QingKe+HuangYou&display=swap" rel="stylesheet">
    
    <!-- 부트스트랩 -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">    <script src="https://code.jquery.com/jquery-3.6.0.slim.js" integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
   
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>

    <title>간지나는 당신 곁엔,NearFetch</title>
</head>
<body>
    <!-- 헤더 -->
    <header include-html="/component/header.html"></header>


    <!-- 메인 -->
    <main> 
        <div class="section searchItemWrapper">
            <div class="currentCategoryWrapper">
                <ul class="currentCategory">
                    <li id="gender">
                        <a href="">여성</a>
                        <img src="/images/next.png" alt="" width="15px">
                    </li>
                    <li>
                        <a href="">GUCCI</a>
                    </li>
                </ul>
            </div>
            
            <!-- 카테고리 필터&정렬 필터 -->
            <div class="sortingWrapper">
                <!-- 카테고리 필터(좌) -->
                <div include-html="/component/filter.html"></div>

               <!-- 정렬 필터 -->
               <div include-html="/component/sorter.html"></div>
           </div>

           <!-- 아이템자리 -->
           <div class="itemListWrapper">
               <!-- 상품리스트 -->
           </div>
        </div>
    </main>

    <!-- 푸터 -->
    <footer include-html="/component/footer.html"></footer>
     <!-- 연결 css/js/jquery 파일 -->
     <link rel="stylesheet" href="/style.css">
     <script src="/common.js" defer></script>
     <script src="/commonJquery.js"></script>
   <script src="/women_products.json"></script>
   <script src="https://developers.kakao.com/sdk/js/kakao.js"></script>

    <script>
          
       let itemList = JSON.parse(JSON.stringify(data));
       const itemListWrapper = document.querySelector('.searchItemWrapper>.itemListWrapper')
       const ul = document.createElement('ul');
       itemListWrapper.appendChild(ul);

       function isGUCCI(itemList)  {
            if(itemList.itemBrand === 'GUCCI')  {
                return true;
            }
            }

        const gucciItem = itemList.filter(isGUCCI);
    
        for (let i = 0; i < gucciItem.length; i += 1) {
            const cart = document.createElement('img')
            cart.setAttribute("class","cart")
            cart.src="/images/shopping-cart.png";

            const img = document.createElement('img')
            img.setAttribute("class","itemImg")
            img.src=gucciItem[i].itemImg[0];

            const li = document.createElement('li');
        
            const div = document.createElement('div');
            div.setAttribute("class","itemBrand");

            const div1 = document.createElement('div');
            div1.setAttribute("class","itemName");

            const div2 = document.createElement('div');
            div2.setAttribute("class","price");

            const div3 = document.createElement('div');
            div3.setAttribute("class","skuNum");

            ul.appendChild(li); //itemwrapper>li 추가
            li.appendChild(cart);//itemwrapper>li>img 추가
            li.appendChild(img);//itemwrapper>li>img 추가
            li.appendChild(div);//itemwrapper>li>div 추가
            li.appendChild(div1);//itemwrapper>li>div 추가
            li.appendChild(div2);//itemwrapper>li>div 추가
            li.appendChild(div3);//itemwrapper>li>div 추가


            div.textContent=gucciItem[i].itemBrand; 
            div1.textContent=gucciItem[i].itemName; 
            div2.textContent=gucciItem[i].price.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","); 
            div3.textContent=gucciItem[i].skuNum; 
            const price=document.querySelectorAll(".price");
            price.toLocaleString()
        
        }
            // 클릭/함수실행/페이지 이동
            // btn.addEventListener('click',e => {
            //     e.preventDefault();
            //     fetch("http://172.20.10.6:8000/users/cart", {
            //             method: "GET",
            //             headers: {
            //                 "Content-Type": "application/json",
            //                 Authorization: localStorage.getItem('login-token')
            //             },
            //             body: JSON.stringify(param),
            //         })
            //         .then((response) => response.json())
            //         .then((response) => console.log(response))
            //         .catch((error) => console.log("error:", error));
            //     window.location.href="add.html";
            // });

            // 클릭한 요소 정보
            const clickedImgInfo = document.querySelectorAll('img');
            clickedImgInfo.forEach((el, index, ) => {
                el.onclick = (e) => {
                let parentTag=e.target.parentElement; //클릭한 요소의 부모 태그 전체
                let child=parentTag.childNodes; //클릭한 요소들의 형제 태그 전체
                let sku=child[5].innerText;//클릭한 요소의 sku넘버(=전달할 요소)
                let btn=child[0];
                console.log(btn)

                btn.addEventListener('click', e => {
                    e.preventDefault();
                    let param = {
                        'sku_number' : sku
                        }           
                    fetch("http://172.20.10.6:8000/users/cart", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            Authorization: localStorage.getItem('login-token')
                        },
                        body: JSON.stringify(param),
                    })
                    .then((response) => response.json())
                    .then((response) => console.log(response))
                    .then(function(){
                        alert('장바구니 페이지로 이동하시겠습니까?');
                        window.location.href="http://127.0.0.1:5500/myinfoAll/add/add.html";
                    //     fetch("http://172.20.10.6:8000/users/cart", {
                    //     method: "GET",
                    //     headers: {
                    //         "Content-Type": "application/json",
                    //         Authorization: localStorage.getItem('login-token')
                    //     },
                    // })
                    }
                    )
                    .catch((error) => console.log("error:", error));
                }); 
            
                
            }})
            
            // <!-- 로그인 테스트(with 토큰넘버) -->
        //     window.onload=function(){
        //         const loginbtn=document.querySelectorAll("#loginBtn");
        //         console.log(loginbtn)
        //         loginbtn.addEventListener('click', e => {
        //         let mail = document.querySelector('#mail').value;
        //         let pw = document.querySelector('#password').value;
        //          e.preventDefault();
        //         let param = {
        //             'email' : mail,
        //             'password' : pw
        //         }           
        //         fetch("http://172.20.10.6:8000/users/signin", {
        //             method: "POST",
        //             headers: {
        //                 "Content-Type": "application/json",
        //             },
        //             body: JSON.stringify(param),
        //         })
        //         .then((response) => response.json())
        //         .then((response) => {
        //             if(response.access_token) {
        //                 localStorage.setItem('login-token',response.access_token);
        //                 alert('로그인 성공')
        //             } else{
        //                 alert('로그인 실패')
        //             }
        //         })
        //         .catch((error) => console.log("error:", error));
        //     });  
        // }
            


           
         

        // 장바구니 테스트  
            // const btn=document.querySelector("button");
            // btn.addEventListener('click', e => {
            //     let sku = document.querySelector('.skuNum').innerText;
            //     e.preventDefault();
            //     let param = {
            //         'sku_number' : sku
            //         }           
            //     fetch("http://172.20.10.6:8000/users/cart", {
            //         method: "POST",
            //         headers: {
            //             "Content-Type": "application/json",
            //             Authorization: localStorage.getItem('login-token')
            //         },
            //         body: JSON.stringify(param),
            //     })
            //     .then((response) => response.json())
            //     .then((response) => console.log(response))
            //     .then(function(){
            //         alert('장바구니 페이지로 이동하시겠습니까?');
            //         window.location.href="add.html";
            //         fetch("http://172.20.10.6:8000/users/cart", {
            //         method: "GET",
            //         headers: {
            //             "Content-Type": "application/json",
            //             Authorization: localStorage.getItem('login-token')
            //         },
            //     })
            //     }
            //     )
            //     .catch((error) => console.log("error:", error));
            // });  

   </script>

</body>
</html>