<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- meta정보 -->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- 구글 폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=BhuTuka+Expanded+One&family=Comfortaa:wght@600&family=Do+Hyeon&family=Gowun+Dodum&family=Hi+Melody&family=Nanum+Pen+Script&family=Noto+Sans+SC:wght@100;400&family=Oswald:wght@300&family=Permanent+Marker&family=Quintessential&family=Rowdies:wght@300;400&family=Sedgwick+Ave&family=Shadows+Into+Light&family=Source+Code+Pro:wght@200&family=Staatliches&family=Stylish&family=Sunflower:wght@300&family=ZCOOL+QingKe+HuangYou&display=swap"
      rel="stylesheet"
    />

    <!-- 부트스트랩 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.6.0.slim.js"
      integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <!-- jQuery -->
    <script
      src="https://code.jquery.com/jquery-3.6.0.js"
      integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
      crossorigin="anonymous"
    ></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>

    <!-- 사이트 이름 -->
    <title>간지나는 당신 곁엔,NearFetch</title>
  </head>
  <body>
    <!-- 헤더 -->
    <header include-html="/NEARFETCH_js_version/component/header.html"></header>

    <!-- 메인 -->
    <main>
      <div class="hotBrandWrapper">
        <h2>난리 중 최고 난리난 브랜드</h2>
        <div class="section mainHotBrand">
          <div class="mainHot one">
            <img
              src="https://c.bannerflow.net/accounts/farfetch/5885fca2b801c913d4b04244/images/fb1d6425-818b-4dc0-bf76-664294c1d3b1.jpg"
              alt=""
            />
            <div class="itemBrand">MON XCHLOE</div>
            <div class="brandIntro">매우간지짱짱브랜드</div>
          </div>
          <div class="mainHot two">
            <img
              src="https://c.bannerflow.net/accounts/farfetch/5885fca2b801c913d4b04244/images/fb1d6425-818b-4dc0-bf76-664294c1d3b1.jpg"
              alt=""
            />
            <div class="itemBrand">MON XCHLOE</div>
            <div class="brandIntro">매우간지짱짱브랜드</div>
          </div>
          <div class="mainHot three">
            <img
              src="https://c.bannerflow.net/accounts/farfetch/5885fca2b801c913d4b04244/images/fb1d6425-818b-4dc0-bf76-664294c1d3b1.jpg"
              alt=""
            />
            <div class="itemBrand">MON XCHLOE</div>
            <div class="brandIntro">매우간지짱짱브랜드</div>
          </div>
        </div>
      </div>
      <div class="section hotBrandItem">
        <h2>난리난 브랜드의 상품들, <br />한번에 모아보기</h2>

        <!-- 현재 카테고리 위치 -->
        <div class="currentCategoryWrapper">
          <div class="gender">
            <a href="">여성</a>
          </div>
          <img src="/images/next.png" alt="" width="15px" />
          <div class="itemBrand">
            <a href="">GUCCI</a>
          </div>
        </div>

        <!-- 카테고리 필터&정렬 필터 -->
        <div class="sortingWrapper">
          <!-- 카테고리 필터(좌) -->
          <div include-html="/NEARFETCH_js_version/component/filter.html"></div>

          <!-- 정렬 필터 -->
          <div include-html="/NEARFETCH_js_version/component/sorter.html"></div>
        </div>

        <!-- 아이템자리 -->
        <div class="itemListWrapper">
          <!-- 상품 정보 -->
        </div>
      </div>
    </main>
    <!-- 푸터 -->
    <footer include-html="/NEARFETCH_js_version/component/footer.html"></footer>

    <!-- 연결 css/js/jquery 파일 -->
    <link rel="stylesheet" href="/NEARFETCH_js_version/style.css" />
    <script src="/NEARFETCH_js_version/common.js" defe></script>
    <script src="/NEARFETCH_js_version/commonJquery.js"></script>
    <script>
      const searchItemListWrapper = document.querySelector(
        ".hotBrandItem>.itemListWrapper"
      );
      function hobrandItemListInit() {
        fetch("http://172.20.10.6:8000/products/list", {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((response) => {
            // const mainHotBrand=document.querySelector(".mainHotBrand")
            // const array=[];
            // for(let k=0;k<response.result.length;k++){
            //     array.push(response.result[k].itemBrand)
            // };

            // // 브랜드별 상품 갯수
            // const result = array.reduce((accu, curr) => {
            // accu[curr] = (accu[curr] || 0)+1;
            // return accu;
            // }, {});

            // // 10개 상품 이상 보유한 브랜드
            // for(let j=0;j<result.length;j++){
            //     if(result[j]>5){
            //     const overTen=[];
            //     overTen.push(result[j]);
            //     }
            // }

            const ul = document.createElement("ul");
            searchItemListWrapper.appendChild(ul);

            for (let i = 0; i < response.result.length; i += 1) {
              const cart = document.createElement("img");
              cart.setAttribute("class", "cart");
              cart.src = "/images/shopping-cart.png";

              //   아이템 이미지를 누르면 상품 상세로 이동
              const itemImg = document.querySelectorAll(".imgWrapAtag");
              itemImg.forEach((el, index) => {
                el.onclick = (e) => {
                  // e.preventDefault();
                  let parentTag = e.target.parentElement; //클릭한 요소의 부모 태그 전체
                  let aa = parentTag.parentElement; //클릭한 요소의 부모 태그 전체
                  let child = aa.childNodes; //클릭한 요소들의 형제 태그 전체
                  sku = child[6].innerText;
                  localStorage.setItem("sku", sku);
                  // console.log(sku)
                };
              });

              const aTag = document.createElement("a");
              aTag.setAttribute("class", "imgWrapAtag");
              aTag.href =
                "http://127.0.0.1:5500/NEARFETCH_js_version/item%20detail/itemdetail.html";

              const img = document.createElement("img");
              img.setAttribute("class", "itemImg");
              img.src = response.result[i].itemImg[0];

              const li = document.createElement("li");
              ul.appendChild(li);
              li.appendChild(cart);
              aTag.appendChild(img);
              li.appendChild(aTag);

              const classList = [
                "itemBrand",
                "itemName",
                "price",
                "sale_price",
                "skuNum",
              ];

              for (let k = 0; k < classList.length; k++) {
                const div = document.createElement("div");
                div.setAttribute("class", classList[k]);
                li.appendChild(div);
              }

              document.querySelectorAll(".itemBrand")[i].innerText =
                response.result[i][classList[0]];
              document.querySelectorAll(".itemName")[i].innerText =
                response.result[i][classList[1]];
              document.querySelectorAll(".price")[i].innerText =
                response.result[i][classList[2]];
              document.querySelectorAll(".sale_price")[i].innerText =
                response.result[i][classList[3]];
              document.querySelectorAll(".skuNum")[i].innerText =
                response.result[i][classList[4]];
            }

            // 카트 로고 눌러서 장바구니 담기
            const cartBtn = document.querySelectorAll(".cart");
            cartBtn.forEach((el, index) => {
              el.onclick = (e) => {
                let parentTag = e.target.parentElement; //클릭한 요소의 부모 태그 전체
                let sku = parentTag.childNodes[6].innerText;
                e.preventDefault();

                let param = {
                  sku_number: sku,
                };

                fetch("http://172.20.10.6:8000/users/cart", {
                  method: "POST",
                  headers: {
                    "Content-Type": "application/json",
                    // Authorization: localStorage.getItem('login-token')
                  },
                  body: JSON.stringify(param),
                })
                  .then((response) => response.json())
                  .then((response) => console.log(response))
                  .then(function () {
                    alert("장바구니 페이지로 이동하시겠습니까?");
                  })
                  .catch((error) => console.log("error:", error));
              };
            });

            const highToRow = document.querySelector(".sortDetail .highToRow"); //높은가격순
            const rowToHigh = document.querySelector(".sortDetail .rowToHigh"); //낮은가격순
            const views = document.querySelector(".sortDetail .views"); //인기순(=view순)
            const sortDetailList = [highToRow, rowToHigh, views];

            for (let k = 0; k < sortDetailList.length; k++) {
              sortDetailList[k].addEventListener("click", () => {
                fetch(
                  `http://172.20.10.6:8000/products/list?order=${sortDetailList[k].innerText}`,
                  {
                    method: "GET",
                    headers: {
                      "Content-Type": "application/json",
                    },
                  }
                )
                  .then((response) => response.json())
                  .then((response) => {
                    const brandItemListWrapper =
                      document.querySelector(".itemListWrapper");
                    brandItemListWrapper.textContent = "";
                    console.log(response.result);

                    const ul = document.createElement("ul");
                    searchItemListWrapper.appendChild(ul);

                    for (let i = 0; i < response.result.length; i += 1) {
                      const cart = document.createElement("img");
                      cart.setAttribute("class", "cart");
                      cart.src = "/images/shopping-cart.png";

                      const img = document.createElement("img");
                      img.setAttribute("class", "itemImg");
                      img.src = response.result[i].itemImg[0];

                      const li = document.createElement("li");

                      const div = document.createElement("div");
                      div.setAttribute("class", "itemBrand");

                      const div1 = document.createElement("div");
                      div1.setAttribute("class", "itemName");

                      const div2 = document.createElement("div");
                      div2.setAttribute("class", "price");

                      const div3 = document.createElement("div");
                      div3.setAttribute("class", "skuNum");

                      ul.appendChild(li);
                      li.appendChild(cart);
                      li.appendChild(img);
                      li.appendChild(div);
                      li.appendChild(div1);
                      li.appendChild(div2);
                      li.appendChild(div3);

                      div.textContent = response.result[i].itemBrand;
                      div1.textContent = response.result[i].itemName;
                      div2.textContent = response.result[i].price
                        .toString()
                        .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                      div3.textContent = response.result[i].skuNum;
                      const price = document.querySelectorAll(".price");
                      price.toLocaleString();
                    }
                  });
              });
            }

            // 정렬필터(우)
            var sortDetail = document.querySelector(".sortDetail"); //가려진 부분
            var sortWrapper = document.querySelector(".sortWrapper"); //sortingBox
            var updownBtn = document.querySelector(".updownBtn"); //정렬 화살표(상하)

            sortWrapper.addEventListener("click", () => {
              sortDetail.classList.toggle("active");
              sortWrapper.classList.toggle("active");
              updownBtn.classList.toggle("active");
            });
          });
      }

      hobrandItemListInit();
    </script>
  </body>
</html>
