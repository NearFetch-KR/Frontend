
<!DOCTYPE html>
<html lang="en">
<head>
     <!-- meta정보 -->
     <meta charset="UTF-8">
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
     <!-- 구글 폰트 -->
     <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=BhuTuka+Expanded+One&family=Comfortaa:wght@600&family=Do+Hyeon&family=Gowun+Dodum&family=Hi+Melody&family=Nanum+Pen+Script&family=Noto+Sans+SC:wght@100;400&family=Oswald:wght@300&family=Permanent+Marker&family=Quintessential&family=Rowdies:wght@300;400&family=Sedgwick+Ave&family=Shadows+Into+Light&family=Source+Code+Pro:wght@200&family=Staatliches&family=Stylish&family=Sunflower:wght@300&family=ZCOOL+QingKe+HuangYou&display=swap" rel="stylesheet">
     
     <!-- 부트스트랩 -->
     <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">    <script src="https://code.jquery.com/jquery-3.6.0.slim.js" integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY=" crossorigin="anonymous"></script>
     <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
     
     <!-- jQuery -->
     <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
     <script src="//cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>
   
    <title>간지나는 당신 곁엔,NearFetch</title>
</head>
<body>
    <!-- 헤더 -->
    <header include-html="/NEARFETCH_js_version/component/header.html"></header>


    <!-- 메인 -->
    <main>
        <!-- 한 가지라도 누락될 경우 결제 버튼 눌리지 않음 -->
        <!-- 여러가지 담을 경우 결제 금액은 총 합계가 나올 것 -->
        <!-- pay -->
        <div class="section pay">

           <!-- 좌측: 주문자 정보 -->
           <div class="payInfo">
               <!-- 이름/연락처 -->
                <div class="ordererInfo">
                    <h3>주문자 정보</h3>
                    <div class="contactInfo" include-html="/NEARFETCH_js_version/component/contactInfo.html"></div>
                </div>

                <!-- 배송지 -->
                <div class="shippingInfo">
                    <h3>배송지 정보</h3>
                    <div class="checkSame">
                        <input type="checkbox" class="sameToOrderer"> 주문자와 동일
                    </div>
                    <br>
                    <div class="contactInfo" include-html="/NEARFETCH_js_version/component/contactInfo.html"></div>

                    <div class="basicInfo">
                        <label for="member_post">주소</label>
                        <div class="addressBox">
                            <input id="member_post"  type="text" placeholder="우편번호" readonly onclick="findAddr()"><br>
                            <input id="member_addr" type="text" placeholder="주소(클릭)" readonly>
                            <input type="text" placeholder="상세주소(직접입력)">
                        </div>
                    </div>

                </div>
                <div class="paymentInfo">
                    <h3>결제 수단</h3>
                    <ul>
                        <li id="creditCard">신용카드</li>
                        <li id="transfer">가상계좌</li>
                    </ul>
                </div>
           </div>

           <!-- 우측: 주문상품 및 금액 -->
           <div class="orderInfo">
               <div class="orderInfoDetail">
                    <div class="orderItem">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col"></th>
                                    <th scope="col">상품 정보</th>
                                    <th scope="col">옵션</th>
                                    <th scope="col">수량</th>
                                    <th scope="col">가격</th>
                                </tr>
                            </thead>
                            <tbody>
                             <!-- 동적 생성 -->
                            </tbody>
                          </table>
                    </div>
                    <div class="totalAmount">총 금액 : <span></span></div>
                    <div class="orderAgree">
                        <div class="agreeWrapper">
                            <input type="checkbox" name="agree" value="selectAll" onclick="selectAll(this)"> 전체 동의<br>
                            <input type="checkbox" name="agree"> 주문상품에 대한 정보 및 구매 동의<br>
                            <input type="checkbox" name="agree"> 배송정보 제공 동의<br>
                            <input type="checkbox" name="agree"> 제3자 정보 제공,마케팅 수신 동의
                        </div>
                        <button>결제하기</button>
                    </div>
           </div>
        </div>
    </main>

    <!-- 푸터 -->
     <footer include-html="/NEARFETCH_js_version/component/footer.html"></footer>
  
     <!-- 연결 css/js/jquery 파일 -->
    <link rel="stylesheet" href="/NEARFETCH_js_version/style.css">
    <script src="/NEARFETCH_js_version/common.js" defer></script>
    <script src="/NEARFETCH_js_version/myinfoAll/myinfoAll.js"></script>
    <script src="/NEARFETCH_js_version/pay/pay.js"></script>
    <script src="/NEARFETCH_js_version/commonJquery.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>

    fetch("http://172.30.1.23:8000/users/cart", {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          Authorization: localStorage.getItem("login-token")
        },
      })
        .then((response) => response.json())
        .then((response) => {
            for (let k = 0; k < response.result.length; k++) {
            const payitemListWrapper = document.querySelector(
              ".orderInfoDetail tbody"
            );
            const tr = document.createElement("tr");
            payitemListWrapper.appendChild(tr);

            for (let i = 0; i < 5; i++) {
              const tdClassList = [
                "addImg",
                "contents",
                "itemOption",
                "itemQt",
                "priceWrapper",
                // "removeCart",
              ];
              const td = document.createElement("td");
              tr.appendChild(td);
              td.setAttribute("class", tdClassList[i]);
            }

            const addImg = document.querySelectorAll("tbody .addImg");
            const img = document.createElement("img");
            addImg[k].appendChild(img);
            const imgInner = document.querySelectorAll(".addImg img");
            imgInner[k].src = response.result[k].image;

            const contents = document.querySelectorAll("tbody .contents");
            const contentsClassList = ["itemBrand", "itemName"];
            for (let j = 0; j < contentsClassList.length; j++) {
              const div = document.createElement("div");
              contents[k].appendChild(div);
              div.setAttribute("class", contentsClassList[j]);
            }

            const priceWrapper = document.querySelectorAll("tbody .priceWrapper");
            const priceClassList = ["price", "sale_price"];
            for (let j = 0; j < priceClassList.length; j++) {
              const div = document.createElement("div");
              priceWrapper[k].appendChild(div);
              div.setAttribute("class", priceClassList[j]);
            }

            const itemOption = document.querySelectorAll(".itemOption");
            const divTag = document.createElement("div");
            itemOption[k].appendChild(divTag);
          

            const price = document.querySelectorAll(".priceWrapper>.price");
            const sale_price = document.querySelectorAll(
              ".priceWrapper>.sale_price"
            );

            const itemQt = document.querySelectorAll(".itemQt");
            const itemBrand = document.querySelectorAll(".itemBrand");
            const itemName = document.querySelectorAll(".itemName");

            itemBrand[k].textContent = response.result[k].brand;
            itemName[k].textContent = response.result[k].name;

            itemQt[k].textContent = response.result[k].quantity;
            itemOption[k].textContent = response.result[k].selectedOption;//옵션값
            price[k].textContent = response.result[k].price;
            sale_price[k].textContent = response.result[k].sale_price;
        }

        const totalAmount = document.querySelector(".totalAmount>span");
        const price = document.querySelectorAll("tr .price");
        const sale_price = document.querySelectorAll("tr .sale_price");

      // 할인 가격 보여주기
      for (let i = 0; i < price.length; i++) {
              if (sale_price[i].innerText == "") {
                //세일 안 할 때
                price[i].style.display = "block";
                sale_price[i].style.display = "none";
                price[i].textContent = price[i].textContent
                  .toString()
                  .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
              } else {
                sale_price[i].style.display = "block";
                price[i].style.textDecoration = "line-through";
                sale_price[i].textContent = sale_price[i].textContent
                  .toString()
                  .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
              }
            }


            //  장바구니, 주문창 총 금액 계산
          const priceArry = [];
          for (i = 0; i < response.result.length; i++) {
            if (response.result[i].sale_price !== null) {
              priceArry.push(Number(sale_price[i].innerText.split(",").join("")));
            } else {
              priceArry.push(Number(price[i].innerText.split(",").join("")));
            }
          }

          const sum = priceArry.reduce((a, b) => a + b);
          totalAmount.textContent = sum
            .toString()
            .replace(/\B(?=(\d{3})+(?!\d))/g, ",");




            
    });
    </script>
  
</body>
</html>