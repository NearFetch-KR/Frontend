<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- meta정보 -->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- 구글 폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=BhuTuka+Expanded+One&family=Comfortaa:wght@600&family=Do+Hyeon&family=Gowun+Dodum&family=Hi+Melody&family=Nanum+Pen+Script&family=Noto+Sans+SC:wght@100;400&family=Oswald:wght@300&family=Permanent+Marker&family=Quintessential&family=Rowdies:wght@300;400&family=Sedgwick+Ave&family=Shadows+Into+Light&family=Source+Code+Pro:wght@200&family=Staatliches&family=Stylish&family=Sunflower:wght@300&family=ZCOOL+QingKe+HuangYou&display=swap"
      rel="stylesheet"
    />

    <!-- 부트스트랩 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.6.0.slim.js"
      integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <!-- jQuery -->
    <script
      src="https://code.jquery.com/jquery-3.6.0.js"
      integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
      crossorigin="anonymous"
    ></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>

    <title>간지나는 당신 곁엔,NearFetch</title>
  </head>
  <body>
    <!-- 헤더 -->
    <header include-html="/NEARFETCH_js_version/component/header.html"></header>

    <!-- 메인 -->
    <main>
      <div class="section myInfoList">
        <div class="infoBar">
          <ul>
            <li><a href="">내 정보</a></li>
            <li><a href="">주소록</a></li>
            <li><a href="">주문 내역</a></li>
            <li><a href="">장바구니</a></li>
            <li><a href="" id="logout">로그아웃</a></li>
          </ul>
        </div>

        <div class="myInfo">
          <h3>넘나리 소중한 나의 정보</h3>
          <div class="myInfoWrapper" id="myInfoWrapper">
            <div class="imgNextoMyinfo">
              <!-- 사진(랜덤) -->
              <img src="/images/fashion.jpg" alt="" width="100%" />
            </div>
            <div class="myInfoAddress">
              <h6>
                더욱 편리한 모던 럭셔리 쇼핑 경험을 위해 고객님의 개인 정보와
                주문 내역이 안전하게 저장되었습니다.
              </h6>
              <div class="basicInfo">
                <label for="member_post">주소</label>
                <div class="addressBox">
                  <input
                    id="member_post"
                    type="text"
                    placeholder="우편번호"
                    readonly
                    onclick="findAddr()"
                    onchange="getAddressValue()"
                  /><br />
                  <input
                    id="member_addr"
                    type="text"
                    placeholder="주소"
                    readonly
                    onchange="getAddressValue()"
                  />
                  <input
                    id="addr_detail"
                    type="text"
                    placeholder="상세주소(직접입력)"
                    onchange="getAddressValue()"
                  />
                </div>
              </div>
              <button id="save">저장</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- 푸터 -->
    <footer include-html="/NEARFETCH_js_version/component/footer.html"></footer>

    <!-- 연결 css/js/jquery 파일 -->
    <link rel="stylesheet" href="/NEARFETCH_js_version/style.css" />
    <script src="/NEARFETCH_js_version/common.js" defer></script>
    <script src="/NEARFETCH_js_version/commonJquery.js"></script>
    <script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
    <script>
      /* ----------------내 정보(통합)/myinfoAll.html---------------- */

      // 주소 검색(by kakao)
      function findAddr() {
        new daum.Postcode({
          oncomplete: function (data) {
            // console.log(data);
            var roadAddr = data.roadAddress; // 도로명 주소 변수
            var jibunAddr = data.jibunAddress; // 지번 주소 변수
            // 우편번호와 주소 정보를 해당 필드에 넣는다.
            document.getElementById("member_post").value = data.zonecode;
            if (roadAddr !== "") {
              document.getElementById("member_addr").value = roadAddr;
            } else if (jibunAddr !== "") {
              document.getElementById("member_addr").value = jibunAddr;
            }
          },
        }).open();
      }

      // 주소 저장(성공)
      const saveAddressBtn = document.querySelector(".myInfoAddress #save");
      const member_post_Default = document.querySelector(
        ".myInfoAddress #member_post"
      );
      const member_addr_Default = document.querySelector(
        ".myInfoAddress #member_addr"
      );
      const addr_detail_Default = document.querySelector(
        ".myInfoAddress #addr_detail"
      );

      function getAddressValue() {
        member_post = document.querySelector(
          ".myInfoAddress #member_post"
        ).value;
        member_addr = document.querySelector(
          ".myInfoAddress #member_addr"
        ).value;
        addr_detail = document.querySelector(
          ".myInfoAddress #addr_detail"
        ).value;
      }

      member_post_Default.addEventListener("onkeyup", getAddressValue);
      member_addr_Default.addEventListener("onkeyup", getAddressValue);
      addr_detail_Default.addEventListener("onkeyup", getAddressValue);

      saveAddressBtn.addEventListener("click", (e) => {
        e.preventDefault();
        let param = {
          post_number: member_post,
          address1: member_addr,
          address2: addr_detail,
        };
        let token = localStorage.getItem("login-token");
        fetch("http://172.30.1.19:8000/users/register/location", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: token,
          },
          body: JSON.stringify(param),
        })
          .then((response) => response.json())
          .then((response) => {
            alert("주소 저장이 완료되었습니다.");
          })
          .catch((error) => console.log("error:", error));
      });

      const member_post_saved = document.querySelector(
        ".myInfoAddress #member_post"
      ).value;
      const member_addr_saved = document.querySelector(
        ".myInfoAddress #member_addr"
      ).value;
      const addr_detail_saved = document.querySelector(
        ".myInfoAddress #addr_detail"
      ).value;

      //저장해둔 주소 노출
      fetch("http://172.30.1.19:8000/users/register/location", {
        method: "GET",
        headers: {
          "Content-Type": "application/json",
          Authorization: localStorage.getItem("login-token"),
        },
      })
        .then((response) => response.json())
        .then((response) => {
          const member_post_saved = response.result.post_number;
          const member_addr_saved = response.result.address1;
          const addr_detail_saved = response.result.address2;

          if (member_post_saved && member_addr_saved && addr_detail_saved) {
            member_post_Default.value = member_post_saved;
            member_addr_Default.value = member_addr_saved;
            addr_detail_Default.value = addr_detail_saved;
          }
        })
        .catch((error) => console.log("error:", error));

      // //배송중인것만 배송정보 보여주기!
      // const trkStatus = document.querySelectorAll(".trkStatus"); //배송상태값
      // const trkInfo = document.querySelectorAll(".trkInfo"); //배송정보

      // for (i = 0; i < trkStatus.length; i++) {
      //   if (trkStatus[i].innerText == "배송중") {
      //     trkInfo[i].style.display = "block";
      //   } else {
      //     trkInfo[i].style.display = "none";
      //   }
      // }
      // //n번째 돋보기를 누르면 n번째 송장번호가 들어간 택배 조회창으로 이동
      // // const n=document.querySelectorAll('.n'); //n번째 순서값
      // const trkBtn = document.querySelectorAll(".trkInfo>img"); // 운송장 조회 버튼
      // const trkCompany = document.querySelectorAll(".trkCompany"); //택배사
      // const trkNum = document.querySelectorAll(".trkNum"); //송장번호

      // //택배 조회
      // trkBtn.forEach(function (trkBtn) {
      //   trkBtn.addEventListener("click", logEvent);
      // });

      // function logEvent(event) {
      //   var number = event.target.closest(".trkInfo").children[1].innerText;
      //   if (event.target.closest(".trkInfo").children[0].innerText == "우체국") {
      //     window.open("about:blank").location.href =
      //       "https://service.epost.go.kr/trace.RetrieveDomRigiTraceList.comm?sid1=" +
      //       number +
      //       "&displayHeader=N";
      //   } else {
      //     window.open("about:blank").location.href =
      //       "http://www.doortodoor.co.kr/servlets/cmnChnnel?tc=dtd.cmn.command.c03condiCrg01Cmd&invc_no=" +
      //       number;
      //   }
      // }
    </script>
  </body>
</html>
