<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- meta정보 -->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- 구글 폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=BhuTuka+Expanded+One&family=Comfortaa:wght@600&family=Do+Hyeon&family=Gowun+Dodum&family=Hi+Melody&family=Nanum+Pen+Script&family=Noto+Sans+SC:wght@100;400&family=Oswald:wght@300&family=Permanent+Marker&family=Quintessential&family=Rowdies:wght@300;400&family=Sedgwick+Ave&family=Shadows+Into+Light&family=Source+Code+Pro:wght@200&family=Staatliches&family=Stylish&family=Sunflower:wght@300&family=ZCOOL+QingKe+HuangYou&display=swap"
      rel="stylesheet"
    />

    <!-- 부트스트랩 -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.6.0.slim.js"
      integrity="sha256-HwWONEZrpuoh951cQD1ov2HUK5zA5DwJ1DNUXaM6FsY="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>

    <!-- jQuery -->
    <script
      src="https://code.jquery.com/jquery-3.6.0.js"
      integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
      crossorigin="anonymous"
    ></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js"></script>

    <title>간지나는 당신 곁엔,NearFetch</title>
  </head>
  <body>
    <!-- 헤더 -->
    <header include-html="/NEARFETCH_js_version/component/header.html"></header>

    <!-- 메인 -->
    <main>
      <div class="section myInfoList">
        <div class="infoBar">
          <ul>
            <li><a href="">내 정보</a></li>
            <li><a href="">주소록</a></li>
            <li><a href="">주문 내역</a></li>
            <li><a href="">장바구니</a></li>
            <li><a href="" id="logout">로그아웃</a></li>
          </ul>
        </div>
        <div class="myInfo">
          <h3>장바구니</h3>
          <div class="myInfoWrapper">
            <h6>
              더욱 편리한 모던 럭셔리 쇼핑 경험을 위해 고객님의 개인 정보와 주문
              내역이 안전하게 저장되었습니다.
            </h6>
            <table class="addListTable">
              <thead>
                <tr>
                  <th scope="col"></th>
                  <th scope="col">상품 정보</th>
                  <th scope="col">옵션</th>
                  <th scope="col">수량</th>
                  <th scope="col">가격</th>
                </tr>
              </thead>
              <tbody>
                <!-- 장바구니 상품 리스트 -->
              </tbody>
            </table>

            <div class="totalNBtn">
              <div class="totalAmount">총 금액 : <span></span></div>
              <button class="proceed">바로 구매하기</button>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- 푸터 -->
    <footer include-html="/NEARFETCH_js_version/component/footer.html"></footer>

    <!-- 연결 css/js/jquery 파일 -->
    <link rel="stylesheet" href="/NEARFETCH_js_version/style.css" />
    <script src="/NEARFETCH_js_version/common.js" defer></script>
    <script src="/NEARFETCH_js_version/commonJquery.js"></script>
    <!-- <script src="/women_products.json"></script> -->
    <script>
      // ----------------장바구니 상품 리스트 노출----------------
      function makeCartList() {
        fetch("http://172.30.1.19:8000/users/cart", {
          method: "GET",
          headers: {
            "Content-Type": "application/json",
          },
        })
          .then((response) => response.json())
          .then((response) => {
            for (let k = 0; k < response.result.length; k++) {
              const addItemListWrapper = document.querySelector(
                ".addListTable tbody"
              );
              const tr = document.createElement("tr");
              addItemListWrapper.appendChild(tr);

              for (let i = 0; i < 5; i++) {
                const tdClassList = [
                  "addImg",
                  "contents",
                  "itemOption",
                  "itemQt",
                  "priceWrapper",
                ];
                const td = document.createElement("td");
                tr.appendChild(td);
                td.setAttribute("class", tdClassList[i]);
              }

              const addImg = document.querySelectorAll("tbody .addImg");
              const img = document.createElement("img");
              addImg[k].appendChild(img);
              const imgInner = document.querySelectorAll(".addImg img");
              imgInner[k].src = response.result[k].image;

              const contents = document.querySelectorAll("tbody .contents");
              const contentsClassList = ["itemBrand", "itemName"];
              for (let j = 0; j < contentsClassList.length; j++) {
                const div = document.createElement("div");
                contents[k].appendChild(div);
                div.setAttribute("class", contentsClassList[j]);
              }

              const priceWrapper = document.querySelectorAll(
                "tbody .priceWrapper"
              );
              const priceClassList = ["price", "sale_price"];
              for (let j = 0; j < priceClassList.length; j++) {
                const div = document.createElement("div");
                priceWrapper[k].appendChild(div);
                div.setAttribute("class", priceClassList[j]);
              }

              const itemOption = document.querySelectorAll(".itemOption");
              const select = document.createElement("select");
              itemOption[k].appendChild(select);
              // console.log(response.result[k].option);

              for (i = 0; i < response.result[k].option.length; i++) {
                const option = document.createElement("option");
                select.appendChild(option);
                option.textContent = response.result[k]["option"][i];
              }

              const price = document.querySelectorAll(".priceWrapper>.price");
              const sale_price = document.querySelectorAll(
                ".priceWrapper>.sale_price"
              );

              const itemQt = document.querySelectorAll(".itemQt");
              const itemBrand = document.querySelectorAll(".itemBrand");
              const itemName = document.querySelectorAll(".itemName");

              itemBrand[k].textContent = response.result[k].brand;
              itemName[k].textContent = response.result[k].name;

              itemQt[k].textContent = response.result[k].quantity;
              //   itemOption[k].textContent = response.result[k].option;
              price[k].textContent = response.result[k].price;
              sale_price[k].textContent = response.result[k].sale_price;

              for (let i = 0; i < sale_price.length; i++) {
                if (sale_price.innerText == null) {
                  price[i].style.display = "block";
                  sale_price[i].style.display = "none";
                  price[i].textContent = price[i].textContent
                    .toString()
                    .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                } else {
                  sale_price[i].style.display = "block";
                  price[i].style.display = "none";
                  sale_price[i].textContent = sale_price[i].textContent
                    .toString()
                    .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
                }
              }
            }

            //  장바구니, 주문창 총 금액 계산
            const totalAmount = document.querySelector(".totalAmount>span");
            const prices = document.querySelectorAll("tr .price");
            const priceArry = [];
            for (i = 0; i < prices.length; i++) {
              priceArry.push(Number(prices[i].innerText));
            }
            const sum = priceArry.reduce((a, b) => a + b);
            totalAmount.textContent = sum
              .toString()
              .replace(/\B(?=(\d{3})+(?!\d))/g, ",");

            // for (let k = 0; k < response.result.length; k++) {
            //   const addItemListWrapper = document.querySelector(
            //     ".addListTable tbody"
            //   );
            //   const tr = document.createElement("tr");
            //   addItemListWrapper.appendChild(tr);

            //   for (let i = 0; i < 5; i++) {
            //     const tdClassList = [
            //       "addImg",
            //       "contents",
            //       "itemOption",
            //       "itemQt",
            //       "price",
            //     ];
            //     const td = document.createElement("td");
            //     tr.appendChild(td);
            //     td.setAttribute("class", tdClassList[i]);
            //   }

            //   const addImg = document.querySelectorAll("tbody .addImg");
            //   const img = document.createElement("img");
            //   addImg[k].appendChild(img);
            //   const imgInner = document.querySelectorAll(".addImg img");
            //   imgInner[k].src = response.result[k].image;

            //   const contents = document.querySelectorAll("tbody .contents");
            //   const contentsClassList = ["itemBrand", "itemName"];
            //   for (let j = 0; j < contentsClassList.length; j++) {
            //     const div = document.createElement("div");
            //     contents[k].appendChild(div);
            //     div.setAttribute("class", contentsClassList[j]);
            //   }

            //   const itemOption = document.querySelectorAll("tbody .itemOption");
            //   const price = document.querySelectorAll("tbody .price");
            //   const itemQt = document.querySelectorAll(".itemQt");
            //   const itemBrand = document.querySelectorAll(".itemBrand");
            //   const itemName = document.querySelectorAll(".itemName");

            //   itemBrand[k].textContent = response.result[k].brand;
            //   itemName[k].textContent = response.result[k].name;

            //   itemQt[k].textContent = response.result[k].quantity;
            //   itemOption[k].textContent = response.result[k].option;
            //   price[k].textContent = response.result[k].price;
            // }

            // //  장바구니, 주문창 총 금액 계산
            // const totalAmount = document.querySelector(".totalAmount>span");
            // const prices = document.querySelectorAll("tr .price");
            // const priceArry = [];
            // for (i = 0; i < prices.length; i++) {
            //   priceArry.push(Number(prices[i].innerText));
            // }
            // const sum = priceArry.reduce((a, b) => a + b);
            // totalAmount.textContent = sum
            //   .toString()
            //   .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
          });
      }

      makeCartList();
    </script>
  </body>
</html>
